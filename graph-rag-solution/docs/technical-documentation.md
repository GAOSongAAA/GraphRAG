# Graph RAG 工业级解决方案技术文档

**作者：Manus AI**  
**版本：1.0.0**  
**日期：2025年6月15日**

## 目录

1. [项目概述](#项目概述)
2. [技术架构](#技术架构)
3. [核心组件](#核心组件)
4. [API 接口文档](#api-接口文档)
5. [部署指南](#部署指南)
6. [开发指南](#开发指南)
7. [性能优化](#性能优化)
8. [监控运维](#监控运维)
9. [故障排查](#故障排查)
10. [最佳实践](#最佳实践)

---

## 项目概述

### 背景与目标

在人工智能快速发展的时代，检索增强生成（Retrieval-Augmented Generation，RAG）技术已成为构建智能问答系统的核心技术之一。传统的 RAG 系统主要基于向量检索，虽然在语义相似性匹配方面表现出色，但在处理复杂的实体关系、多跳推理和结构化知识方面存在明显不足。

图 RAG（Graph RAG）技术的出现为这些挑战提供了创新性的解决方案。通过将知识以图结构的形式组织，图 RAG 能够更好地理解实体间的复杂关系，支持多跳推理，并提供更加准确和全面的答案生成能力。

本项目旨在构建一个基于 Java、LangChain4j 和 Neo4j 的大规模图 RAG 工业级解决方案，具备以下核心目标：

**技术目标：**
- 构建高性能、可扩展的图 RAG 系统架构
- 实现先进的图遍历和向量检索算法
- 提供完整的知识图谱构建和管理能力
- 支持多种检索模式和答案生成策略

**业务目标：**
- 提升问答系统的准确性和完整性
- 支持复杂查询和多跳推理场景
- 降低知识管理和维护成本
- 提供可视化的知识图谱分析能力

**工程目标：**
- 采用微服务架构，支持水平扩展
- 实现完整的监控、日志和告警体系
- 提供标准化的 API 接口和文档
- 支持容器化部署和云原生架构

### 核心特性

本解决方案具备以下核心特性，使其在同类产品中具有显著优势：

**1. 混合检索能力**

系统支持多种检索模式的有机结合，包括向量相似性检索、图遍历检索和全文搜索。通过智能的检索策略选择和结果融合算法，能够根据查询特点自动选择最优的检索方式，显著提升检索的准确性和覆盖度。

向量检索擅长处理语义相似性匹配，能够理解查询的深层含义；图遍历检索则专注于发现实体间的复杂关系，支持多跳推理；全文搜索提供精确的关键词匹配能力。三种检索方式的结合使系统能够应对各种复杂的查询场景。

**2. 智能知识图谱构建**

基于 LangChain4j 的强大自然语言处理能力，系统能够自动从非结构化文档中提取实体、关系和属性，构建高质量的知识图谱。实体识别算法采用了命名实体识别（NER）和实体链接技术，能够准确识别文档中的人物、地点、组织、概念等各类实体。

关系抽取模块使用了基于模式匹配和机器学习的混合方法，能够识别实体间的语义关系，如"属于"、"位于"、"发明"等。系统还支持自定义实体类型和关系类型，以适应不同领域的知识建模需求。

**3. 高级图算法支持**

系统集成了多种先进的图算法，包括中心性分析、社区检测、路径查找和图模式匹配。这些算法为复杂的图分析任务提供了强大的支持，能够发现隐藏的知识模式和关联关系。

中心性分析算法（如 PageRank、度中心性、介数中心性）能够识别知识图谱中的重要节点；社区检测算法能够发现紧密相关的实体群组；路径查找算法支持多跳推理和关系链分析；图模式匹配则能够识别特定的知识模式和结构。

**4. 多层次缓存优化**

为了提升系统性能，解决方案实现了多层次的缓存策略。查询结果缓存能够避免重复计算，显著提升响应速度；向量嵌入缓存减少了重复的向量化计算开销；图遍历结果缓存优化了复杂图查询的性能。

缓存系统支持内存缓存和分布式缓存两种模式，能够根据部署环境和性能需求灵活选择。缓存失效策略采用了 TTL（Time To Live）和 LRU（Least Recently Used）相结合的方式，确保缓存数据的时效性和空间效率。

**5. 企业级安全与监控**

系统内置了完整的安全机制，包括 API 访问控制、数据加密传输、敏感信息脱敏等。访问控制采用了基于角色的权限管理（RBAC），支持细粒度的权限配置。数据传输采用 HTTPS 协议，确保数据在传输过程中的安全性。

监控体系基于 Prometheus 和 Grafana 构建，提供了全面的系统指标监控，包括查询性能、系统资源使用、错误率等关键指标。告警机制能够及时发现和通知系统异常，确保服务的稳定性和可用性。

### 技术选型

本项目的技术选型充分考虑了性能、可扩展性、生态成熟度和团队技术栈等多个因素：

**Java 17：** 作为主要开发语言，Java 17 提供了优秀的性能、丰富的生态系统和强大的企业级支持。新版本的 Java 在内存管理、垃圾回收和并发处理方面都有显著改进，特别适合构建高性能的后端服务。

**Spring Boot 3.2：** 作为应用框架，Spring Boot 提供了完整的企业级开发能力，包括依赖注入、AOP、事务管理、安全控制等。其丰富的生态系统和标准化的开发模式大大提升了开发效率和代码质量。

**LangChain4j 0.25.0：** 作为 LLM 集成框架，LangChain4j 提供了与各种大语言模型的标准化接口，支持文档加载、文本分割、向量化、提示工程等核心功能。其模块化的设计使得系统能够灵活地集成不同的 AI 服务。

**Neo4j 5.15.0：** 作为图数据库，Neo4j 是业界领先的图数据库解决方案，提供了强大的图查询语言 Cypher、高性能的图算法库和完善的集群支持。其原生的图存储引擎为复杂的图查询提供了优异的性能。

**Maven：** 作为构建工具，Maven 提供了标准化的项目结构、依赖管理和构建流程。其丰富的插件生态系统支持代码质量检查、测试覆盖率分析、文档生成等多种功能。

### 应用场景

图 RAG 解决方案适用于多种业务场景，特别是那些需要处理复杂知识关系和多跳推理的应用：

**智能客服系统：** 在客服场景中，用户的问题往往涉及多个相关的产品、服务或政策。图 RAG 能够理解这些复杂的关联关系，提供更加准确和全面的答案。例如，当用户询问"如何办理信用卡并绑定手机银行"时，系统需要理解信用卡办理流程、手机银行功能、绑定操作等多个相关概念之间的关系。

**企业知识管理：** 大型企业通常拥有海量的内部文档、流程规范、技术资料等知识资产。图 RAG 能够将这些分散的知识组织成结构化的知识图谱，支持员工快速查找相关信息，提升工作效率。系统能够理解部门间的协作关系、项目的依赖关系、技术栈的关联关系等复杂的企业知识结构。

**医疗诊断辅助：** 在医疗领域，疾病、症状、药物、治疗方案之间存在复杂的关联关系。图 RAG 能够帮助医生快速查找相关的医学知识，辅助诊断决策。例如，当医生输入患者症状时，系统能够基于医学知识图谱推理出可能的疾病、相关的检查项目和治疗方案。

**金融风控分析：** 金融机构需要分析客户、交易、账户、关联方等多个实体之间的复杂关系来识别风险。图 RAG 能够基于金融知识图谱进行风险分析，发现潜在的欺诈模式和异常行为。系统能够追踪资金流向、分析关联交易、识别可疑网络等。

**科研文献分析：** 科研人员需要从大量的学术文献中发现知识关联和研究趋势。图 RAG 能够构建学术知识图谱，帮助研究人员快速了解某个领域的研究现状、发现潜在的研究方向、识别关键的研究者和机构。




## 技术架构

### 整体架构设计

本图 RAG 解决方案采用分层架构设计，从下至上分为数据存储层、核心服务层、业务逻辑层和接口层。这种分层设计确保了系统的可维护性、可扩展性和模块间的低耦合。

**数据存储层**是整个系统的基础，主要包括 Neo4j 图数据库和 Redis 缓存系统。Neo4j 负责存储知识图谱数据，包括实体节点、关系边和属性信息。其原生的图存储引擎为复杂的图查询提供了卓越的性能。Redis 作为分布式缓存，存储查询结果、向量嵌入和会话信息，显著提升了系统的响应速度。

**核心服务层**实现了系统的核心功能模块，包括知识图谱构建服务、向量化服务、图遍历服务和检索服务。知识图谱构建服务负责从非结构化文档中提取实体和关系，构建高质量的知识图谱。向量化服务基于 LangChain4j 集成的嵌入模型，将文本转换为高维向量表示。图遍历服务实现了多种图算法，支持复杂的图分析任务。检索服务整合了向量检索、图遍历和全文搜索，提供统一的检索接口。

**业务逻辑层**封装了具体的业务逻辑，包括查询理解、上下文融合、答案生成等高级功能。查询理解模块分析用户查询的意图和类型，为后续的检索和生成提供指导。上下文融合模块将来自不同检索渠道的信息进行整合和去重，形成连贯的上下文。答案生成模块基于融合后的上下文，使用大语言模型生成高质量的答案。

**接口层**提供了标准化的 REST API 接口，支持同步和异步查询、文档上传、系统监控等功能。接口层还集成了限流、熔断、监控等企业级功能，确保系统的稳定性和可用性。

### 微服务架构

系统采用微服务架构模式，将不同的功能模块拆分为独立的服务，每个服务都可以独立开发、部署和扩展。这种架构模式带来了以下优势：

**独立部署：** 每个微服务都可以独立部署，不会影响其他服务的运行。这大大提升了系统的部署灵活性和故障隔离能力。当某个服务需要更新时，只需要重新部署该服务，而不需要重启整个系统。

**技术栈灵活性：** 不同的微服务可以采用最适合的技术栈。例如，计算密集型的向量化服务可以使用 GPU 加速，而 I/O 密集型的数据服务可以优化网络和存储性能。

**团队自治：** 不同的团队可以负责不同的微服务，实现真正的团队自治。每个团队可以根据自己的业务需求和技术特点，选择最合适的开发方式和发布节奏。

**弹性扩展：** 可以根据不同服务的负载情况，独立地进行水平扩展。例如，在查询高峰期可以增加检索服务的实例数量，而在文档上传高峰期可以增加知识图谱构建服务的实例数量。

### 数据流架构

系统的数据流设计充分考虑了性能、一致性和可靠性的平衡。数据流主要包括知识图谱构建流程和查询处理流程两个核心路径。

**知识图谱构建流程：**

文档上传后，首先进入文档预处理阶段，包括格式转换、内容清洗和结构化提取。预处理后的文档被送入文本分割器，根据语义边界将长文档分割为适当大小的文本块。每个文本块都会生成对应的向量嵌入，用于后续的相似性检索。

实体识别和关系抽取是知识图谱构建的核心环节。系统使用基于大语言模型的实体识别算法，能够准确识别文档中的各类实体。关系抽取模块分析实体间的语义关系，构建实体关系三元组。所有提取的实体和关系都会经过去重和标准化处理，确保知识图谱的质量和一致性。

最终，标准化后的实体和关系被存储到 Neo4j 图数据库中。系统会自动创建必要的索引和约束，优化查询性能。同时，相关的向量嵌入被存储到向量索引中，支持高效的相似性检索。

**查询处理流程：**

用户查询首先进入查询理解模块，分析查询的意图、类型和复杂度。基于查询分析结果，系统选择最适合的检索策略。对于简单的事实查询，可能只需要向量检索；对于复杂的推理查询，则需要结合图遍历和多跳推理。

检索阶段并行执行多种检索策略，包括向量相似性检索、图遍历检索和全文搜索。每种检索方式都会返回相关的文档、实体和关系信息。上下文融合模块将这些信息进行整合，去除重复内容，按照相关性进行排序。

答案生成阶段基于融合后的上下文，使用大语言模型生成最终答案。生成过程中会考虑查询类型、用户偏好和答案格式要求。生成的答案会经过后处理，包括格式化、事实检查和质量评估。

### 安全架构

系统的安全架构采用纵深防御策略，在多个层面实施安全控制措施。

**网络安全层：** 所有外部通信都采用 HTTPS 协议，确保数据传输的机密性和完整性。系统部署在私有网络中，通过防火墙和网络访问控制列表（ACL）限制不必要的网络访问。负载均衡器配置了 DDoS 防护和 Web 应用防火墙（WAF），能够抵御常见的网络攻击。

**应用安全层：** API 接口实现了基于 JWT（JSON Web Token）的身份认证和授权机制。系统支持基于角色的访问控制（RBAC），可以为不同的用户角色配置不同的权限。所有的 API 调用都会记录详细的审计日志，便于安全分析和合规检查。

**数据安全层：** 敏感数据在存储时采用 AES-256 加密算法进行加密。数据库连接使用 SSL/TLS 加密，防止数据在传输过程中被窃取。系统实现了数据脱敏功能，在非生产环境中使用脱敏后的数据进行开发和测试。

**运行时安全：** 应用程序运行在容器化环境中，利用容器的隔离特性提升安全性。系统定期进行安全扫描，包括依赖库漏洞扫描、容器镜像安全扫描和代码安全扫描。所有的安全事件都会触发告警，安全团队可以及时响应和处理。

### 可扩展性设计

系统的可扩展性设计确保了能够应对不断增长的数据量和用户访问量。

**水平扩展：** 所有的服务都设计为无状态，支持水平扩展。通过增加服务实例的数量，可以线性提升系统的处理能力。负载均衡器会自动将请求分发到不同的服务实例，确保负载的均匀分布。

**数据分片：** Neo4j 支持集群部署和数据分片，可以将大规模的知识图谱分布到多个数据库实例中。分片策略基于实体类型和访问模式进行优化，确保相关的数据尽可能存储在同一个分片中，减少跨分片查询的开销。

**缓存分层：** 系统实现了多层次的缓存架构，包括应用层缓存、分布式缓存和数据库缓存。不同层次的缓存有不同的生存时间（TTL）和淘汰策略，确保缓存的有效性和一致性。

**异步处理：** 对于耗时较长的操作，如知识图谱构建和复杂查询，系统采用异步处理模式。用户可以提交任务后立即获得任务 ID，然后通过轮询或回调的方式获取处理结果。这种设计避免了长时间的连接占用，提升了系统的并发处理能力。

### 容错与高可用

系统的容错和高可用设计确保了在面对各种故障时仍能提供稳定的服务。

**服务冗余：** 所有关键服务都部署多个实例，避免单点故障。当某个服务实例出现故障时，负载均衡器会自动将流量切换到健康的实例上。服务实例的健康检查机制能够及时发现和隔离故障实例。

**数据备份：** Neo4j 数据库配置了主从复制，确保数据的高可用性。系统定期进行数据备份，包括全量备份和增量备份。备份数据存储在不同的地理位置，防止因自然灾害等原因导致的数据丢失。

**熔断机制：** 系统实现了熔断器模式，当下游服务出现故障或响应缓慢时，熔断器会自动切断对该服务的调用，防止故障的级联传播。熔断器支持自动恢复，当下游服务恢复正常时，会逐步恢复对该服务的调用。

**降级策略：** 在系统负载过高或部分服务不可用时，系统会启动降级策略。例如，当图遍历服务不可用时，系统可以仅使用向量检索提供服务；当大语言模型服务不可用时，系统可以返回检索到的原始文档内容。

**监控告警：** 系统部署了全面的监控体系，实时监控各项关键指标，包括服务可用性、响应时间、错误率、资源使用率等。当指标超过预设阈值时，系统会自动发送告警通知，运维团队可以及时响应和处理。


## 核心组件

### 知识图谱构建组件

知识图谱构建组件是系统的核心模块之一，负责从非结构化文档中自动提取实体、关系和属性，构建高质量的知识图谱。该组件采用了多阶段的处理流程，确保提取结果的准确性和完整性。

**文档预处理模块**是知识图谱构建的第一步，负责处理各种格式的输入文档。系统支持多种文档格式，包括 PDF、Word、HTML、纯文本等。预处理过程包括格式转换、编码识别、内容清洗和结构化提取。对于 PDF 文档，系统使用 OCR 技术提取文本内容；对于 HTML 文档，系统会去除标签和样式信息，保留纯文本内容。

**文本分割器**将长文档分割为适当大小的文本块，这是向量化和实体识别的基础。系统实现了多种分割策略，包括基于句子边界的分割、基于段落的分割和基于语义的分割。语义分割策略使用滑动窗口和重叠机制，确保重要的语义信息不会在分割过程中丢失。

**实体识别模块**使用基于大语言模型的命名实体识别技术，能够识别文档中的人物、地点、组织、概念等各类实体。系统支持自定义实体类型，可以根据特定领域的需求扩展实体识别能力。实体识别过程采用了多轮验证机制，通过上下文分析和实体消歧技术，提高识别的准确性。

**关系抽取模块**分析实体间的语义关系，构建实体关系三元组。系统使用了基于模式匹配和机器学习的混合方法，能够识别各种类型的关系，如"属于"、"位于"、"发明"、"影响"等。关系抽取过程考虑了上下文信息和语法结构，确保关系的准确性和完整性。

**实体链接和消歧模块**负责将识别出的实体链接到知识图谱中的标准实体，解决实体歧义问题。系统维护了一个实体词典，包含实体的标准名称、别名和描述信息。链接过程使用了字符串匹配、语义相似性和上下文分析等多种技术，确保链接的准确性。

### 向量化处理组件

向量化处理组件负责将文本内容转换为高维向量表示，为语义相似性检索提供基础。该组件集成了多种先进的嵌入模型，支持不同粒度的向量化处理。

**嵌入模型管理**支持多种预训练的嵌入模型，包括 OpenAI 的 text-embedding-ada-002、Sentence-BERT、BGE 等。系统可以根据不同的应用场景选择最适合的嵌入模型。对于中文文档，系统优先使用针对中文优化的嵌入模型；对于专业领域文档，系统支持使用领域特定的嵌入模型。

**批量向量化处理**优化了大规模文档的向量化效率。系统支持批量处理模式，可以同时处理多个文档或文本块，显著提升处理速度。向量化过程采用了异步处理机制，避免阻塞其他操作。系统还实现了向量化结果的缓存机制，避免重复计算相同内容的向量表示。

**向量索引管理**负责构建和维护高效的向量索引。系统使用了近似最近邻（ANN）算法，如 HNSW（Hierarchical Navigable Small World）和 IVF（Inverted File）等，支持高效的相似性检索。向量索引支持增量更新，当新的文档加入时，可以动态更新索引而不需要重建整个索引。

**相似性计算**实现了多种相似性度量方法，包括余弦相似性、欧几里得距离和点积相似性等。系统可以根据具体的应用需求选择最适合的相似性度量方法。相似性计算过程进行了优化，使用了 SIMD（Single Instruction, Multiple Data）指令和 GPU 加速等技术，提升计算效率。

### 图遍历算法组件

图遍历算法组件实现了多种先进的图算法，为复杂的图分析任务提供支持。该组件充分利用了 Neo4j 的图计算能力，实现了高效的图遍历和分析算法。

**多跳实体检索**是图遍历的核心功能之一，能够从给定的起始实体出发，通过多跳遍历发现相关的实体和关系。系统支持深度优先搜索（DFS）和广度优先搜索（BFS）两种遍历策略，可以根据查询需求选择合适的策略。遍历过程中会考虑关系的权重和方向，确保检索结果的相关性。

**路径查找算法**能够发现两个实体之间的连接路径，支持最短路径、所有路径和 K 短路径等多种查找模式。路径查找在回答"为什么"类型的查询时特别有用，能够提供实体间关联的解释。系统实现了 Dijkstra 算法、A* 算法和双向搜索等经典路径查找算法。

**中心性分析算法**用于识别知识图谱中的重要节点。系统实现了多种中心性度量，包括度中心性、介数中心性、接近中心性和 PageRank 等。中心性分析结果可以用于实体重要性排序、关键实体识别和知识图谱可视化等应用。

**社区检测算法**能够发现知识图谱中的紧密相关实体群组。系统实现了 Louvain 算法、Label Propagation 算法和 Leiden 算法等社区检测方法。社区检测结果可以用于知识分类、主题发现和推荐系统等应用。

**图模式匹配**支持在知识图谱中查找特定的图模式和结构。系统使用 Cypher 查询语言实现复杂的图模式匹配，支持变长路径、可选匹配和聚合查询等高级功能。图模式匹配在规则推理和知识验证中发挥重要作用。

### 检索融合组件

检索融合组件整合了多种检索方式的结果，提供统一的检索接口。该组件实现了智能的检索策略选择和结果融合算法，确保检索结果的准确性和完整性。

**检索策略选择**根据查询特点自动选择最适合的检索方式。对于简单的事实查询，系统优先使用向量检索；对于复杂的关系查询，系统会结合图遍历检索；对于精确匹配查询，系统会使用全文搜索。策略选择基于查询分析结果，包括查询类型、实体数量、关系复杂度等因素。

**并行检索执行**同时执行多种检索方式，提高检索效率。系统使用线程池和异步处理技术，并行执行向量检索、图遍历和全文搜索。并行执行过程中会监控各个检索任务的执行状态，确保在合理的时间内返回结果。

**结果融合算法**将来自不同检索渠道的结果进行整合和排序。融合过程包括去重、相关性评分、多样性过滤等步骤。系统实现了多种融合策略，包括线性组合、排序融合和学习排序等方法。融合算法会考虑不同检索方式的置信度和互补性，确保最终结果的质量。

**相关性评分**为检索结果计算统一的相关性分数。评分过程考虑了多个因素，包括语义相似性、图结构相关性、文本匹配度、实体重要性等。系统使用机器学习方法训练评分模型，能够根据用户反馈不断优化评分准确性。

### 答案生成组件

答案生成组件基于检索到的上下文信息，使用大语言模型生成高质量的答案。该组件实现了多种生成策略，能够根据不同的查询类型和用户需求生成合适的答案。

**提示工程**是答案生成的关键技术，负责构建有效的提示模板。系统针对不同类型的查询设计了专门的提示模板，包括事实查询、概念解释、比较分析、推理问答等。提示模板包含了上下文信息、查询问题、输出格式要求等要素，指导大语言模型生成准确的答案。

**上下文管理**负责组织和优化输入给大语言模型的上下文信息。由于大语言模型的输入长度有限，系统需要智能地选择和组织最相关的上下文信息。上下文管理包括信息筛选、重要性排序、长度控制等功能，确保在有限的输入空间内包含最有价值的信息。

**多轮对话支持**使系统能够处理连续的对话查询。系统维护对话历史和上下文状态，能够理解代词指代、省略表达和上下文依赖等复杂的对话现象。多轮对话功能使系统能够提供更自然和连贯的交互体验。

**答案后处理**对生成的答案进行质量检查和格式优化。后处理包括事实检查、逻辑一致性验证、格式标准化等步骤。系统会检查答案中的事实是否与知识图谱一致，确保答案的准确性。格式优化包括段落组织、列表格式化、引用标注等，提升答案的可读性。

**质量评估**为生成的答案计算质量分数，帮助用户判断答案的可信度。质量评估考虑了多个维度，包括相关性、准确性、完整性、流畅性等。系统使用预训练的质量评估模型，能够自动计算答案的质量分数。质量分数可以用于答案排序、置信度显示和用户反馈收集等应用。


## API 接口文档

### 接口概览

Graph RAG 系统提供了完整的 RESTful API 接口，支持知识图谱构建、智能查询、系统管理等核心功能。所有接口都遵循 REST 设计原则，使用标准的 HTTP 方法和状态码，支持 JSON 格式的请求和响应。

API 接口采用版本化设计，当前版本为 v1，所有接口的基础路径为 `/api/v1/graph-rag`。系统支持 CORS（跨域资源共享），可以被前端应用直接调用。所有接口都集成了 Swagger 文档，开发者可以通过 `/swagger-ui.html` 访问完整的接口文档和在线测试功能。

### 核心查询接口

**POST /api/v1/graph-rag/query**

这是系统最重要的接口，提供智能查询功能。该接口支持多种检索模式，能够根据查询内容自动选择最适合的检索策略。

请求参数：
```json
{
  "question": "什么是人工智能？",
  "retrievalMode": "hybrid",
  "maxDocuments": 5,
  "maxEntities": 10,
  "similarityThreshold": 0.7,
  "includeRelations": true,
  "conversationHistory": "之前我们讨论了机器学习..."
}
```

响应格式：
```json
{
  "success": true,
  "data": {
    "question": "什么是人工智能？",
    "answer": "人工智能是计算机科学的一个分支...",
    "confidence": 0.92,
    "processingTimeMs": 1250,
    "relevantDocuments": [
      {
        "id": 1,
        "title": "AI概述",
        "content": "人工智能的定义和发展历程...",
        "source": "AI教科书",
        "relevanceScore": 0.95
      }
    ],
    "relevantEntities": [
      {
        "id": 1,
        "name": "人工智能",
        "type": "概念",
        "description": "模拟人类智能的技术",
        "relevanceScore": 0.98
      }
    ],
    "relationshipPaths": [
      {
        "startEntity": "人工智能",
        "endEntity": "机器学习",
        "path": ["人工智能", "包含", "机器学习"],
        "pathLength": 2
      }
    ]
  }
}
```

**POST /api/v1/graph-rag/query/async**

异步查询接口，适用于复杂查询或高并发场景。该接口立即返回任务 ID，客户端可以通过轮询或回调方式获取查询结果。

请求参数与同步查询接口相同，响应格式：
```json
{
  "success": true,
  "data": {
    "taskId": "task_1687234567890",
    "status": "processing",
    "estimatedTimeMs": 3000
  }
}
```

**GET /api/v1/graph-rag/query/status/{taskId}**

查询异步任务状态接口，返回任务的执行状态和结果。

响应格式：
```json
{
  "success": true,
  "data": {
    "taskId": "task_1687234567890",
    "status": "completed",
    "progress": 100,
    "result": {
      // 查询结果，格式与同步查询相同
    }
  }
}
```

### 文档管理接口

**POST /api/v1/graph-rag/documents/upload**

单文档上传接口，支持多种文档格式的上传和知识图谱构建。

请求参数：
- `file`: 文档文件（multipart/form-data）
- `source`: 文档来源（可选）
- `category`: 文档分类（可选）
- `metadata`: 文档元数据（可选）

响应格式：
```json
{
  "success": true,
  "data": {
    "documentId": 12345,
    "filename": "AI研究报告.pdf",
    "status": "processing",
    "extractedEntities": 45,
    "extractedRelations": 78
  }
}
```

**POST /api/v1/graph-rag/documents/batch-upload**

批量文档上传接口，支持同时上传多个文档文件。

请求参数：
- `files`: 文档文件数组（multipart/form-data）
- `source`: 统一文档来源（可选）

响应格式：
```json
{
  "success": true,
  "data": {
    "totalFiles": 10,
    "successCount": 8,
    "failedCount": 2,
    "processingTasks": [
      {
        "filename": "文档1.pdf",
        "taskId": "task_doc_001",
        "status": "processing"
      }
    ]
  }
}
```

**GET /api/v1/graph-rag/documents**

文档列表查询接口，支持分页和过滤。

查询参数：
- `page`: 页码（默认 1）
- `size`: 每页大小（默认 20）
- `source`: 文档来源过滤
- `category`: 文档分类过滤
- `keyword`: 关键词搜索

响应格式：
```json
{
  "success": true,
  "data": {
    "total": 150,
    "page": 1,
    "size": 20,
    "documents": [
      {
        "id": 1,
        "title": "AI研究报告",
        "source": "学术期刊",
        "category": "研究",
        "uploadTime": "2025-06-15T10:30:00Z",
        "status": "processed"
      }
    ]
  }
}
```

### 实体和关系接口

**GET /api/v1/graph-rag/entities/{entityName}/related**

获取相关实体接口，返回与指定实体相关的其他实体。

查询参数：
- `maxHops`: 最大跳数（默认 2）
- `maxResults`: 最大结果数（默认 20）
- `relationTypes`: 关系类型过滤

响应格式：
```json
{
  "success": true,
  "data": {
    "centerEntity": {
      "name": "人工智能",
      "type": "概念",
      "description": "模拟人类智能的技术"
    },
    "relatedEntities": [
      {
        "entity": {
          "name": "机器学习",
          "type": "技术",
          "description": "AI的重要分支"
        },
        "relationship": "包含",
        "distance": 1,
        "strength": 0.95
      }
    ]
  }
}
```

**GET /api/v1/graph-rag/entities/search**

实体搜索接口，支持按名称、类型、描述等条件搜索实体。

查询参数：
- `query`: 搜索关键词
- `type`: 实体类型过滤
- `limit`: 结果数量限制

响应格式：
```json
{
  "success": true,
  "data": {
    "entities": [
      {
        "id": 1,
        "name": "人工智能",
        "type": "概念",
        "description": "模拟人类智能的技术",
        "matchScore": 0.98
      }
    ]
  }
}
```

### 系统管理接口

**GET /api/v1/graph-rag/health**

系统健康检查接口，返回系统各组件的运行状态。

响应格式：
```json
{
  "success": true,
  "data": {
    "status": "healthy",
    "timestamp": "2025-06-15T10:30:00Z",
    "components": {
      "database": {
        "status": "up",
        "responseTime": 15
      },
      "cache": {
        "status": "up",
        "responseTime": 2
      },
      "llm": {
        "status": "up",
        "responseTime": 500
      }
    },
    "metrics": {
      "totalDocuments": 1250,
      "totalEntities": 15000,
      "totalRelations": 45000,
      "uptime": "72h 15m"
    }
  }
}
```

**GET /api/v1/graph-rag/stats**

系统统计信息接口，返回详细的系统使用统计。

响应格式：
```json
{
  "success": true,
  "data": {
    "database": {
      "nodeCount": 15000,
      "relationshipCount": 45000,
      "storageSize": "2.5GB"
    },
    "queries": {
      "totalQueries": 10000,
      "successRate": 0.98,
      "averageResponseTime": 1200
    },
    "cache": {
      "hitRate": 0.85,
      "memoryUsage": "512MB"
    }
  }
}
```

### 错误处理

所有 API 接口都采用统一的错误处理机制，错误响应格式如下：

```json
{
  "success": false,
  "error": {
    "code": "INVALID_PARAMETER",
    "message": "查询参数无效",
    "details": "question 参数不能为空",
    "timestamp": "2025-06-15T10:30:00Z",
    "requestId": "req_1687234567890"
  }
}
```

常见错误码：
- `INVALID_PARAMETER`: 参数错误
- `UNAUTHORIZED`: 未授权访问
- `RATE_LIMIT_EXCEEDED`: 超过访问频率限制
- `INTERNAL_ERROR`: 内部服务错误
- `SERVICE_UNAVAILABLE`: 服务不可用

### 认证和授权

API 接口支持多种认证方式：

**API Key 认证：**
```http
GET /api/v1/graph-rag/query
Authorization: Bearer your-api-key
```

**JWT Token 认证：**
```http
GET /api/v1/graph-rag/query
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

### 限流策略

系统实现了多层次的限流策略：

- **IP 限流：** 每个 IP 地址每小时最多 1000 次请求
- **用户限流：** 每个认证用户每小时最多 5000 次请求
- **接口限流：** 查询接口每分钟最多 100 次请求
- **上传限流：** 文档上传每小时最多 50 次请求

当触发限流时，接口返回 429 状态码和重试建议：

```json
{
  "success": false,
  "error": {
    "code": "RATE_LIMIT_EXCEEDED",
    "message": "请求频率超过限制",
    "retryAfter": 60
  }
}
```

