# Graph RAG å•é¡Œè§£æ±ºæŒ‡å—

## ğŸš€ é …ç›®å•Ÿå‹•å•é¡Œ

### å•é¡Œ 1ï¼šSpring Security ç™»éŒ„é é¢å°é–

**ç¾è±¡**ï¼š
- è¨ªå•ä»»ä½• API éƒ½è·³è½‰åˆ° `/login` é é¢
- é¡¯ç¤º Spring Security é»˜èªç™»éŒ„è¡¨å–®
- ç„¡æ³•è¨ªå• Swagger æ–‡æª”æˆ– API ç«¯é»

**åŸå› **ï¼š
é …ç›®å¼•å…¥äº† `spring-boot-starter-security` ä¾è³´ï¼Œä½†æ²’æœ‰é…ç½® Security è¨­ç½®ï¼ŒSpring Security é»˜èªå•Ÿç”¨è¡¨å–®ç™»éŒ„ã€‚

**è§£æ±ºæ–¹æ¡ˆ**ï¼š

#### æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨å·²å‰µå»ºçš„ SecurityConfigï¼ˆæ¨è–¦ï¼‰

æˆ‘å·²ç¶“ç‚ºæ‚¨å‰µå»ºäº† `SecurityConfig.java` é…ç½®é¡ï¼Œè©²é…ç½®ï¼š
- ç¦ç”¨é»˜èªç™»éŒ„é é¢
- å…è¨±æ‰€æœ‰ API è«‹æ±‚ç„¡éœ€èªè­‰
- é…ç½®é©ç•¶çš„å®‰å…¨é ­

æ–‡ä»¶ä½ç½®ï¼š`graph-rag-api/src/main/java/com/graphrag/api/config/SecurityConfig.java`

#### æ–¹æ¡ˆäºŒï¼šè‡¨æ™‚ç¦ç”¨ Securityï¼ˆåƒ…ç”¨æ–¼æ¸¬è©¦ï¼‰

åœ¨ `application.yml` ä¸­æ·»åŠ ï¼š

```yaml
spring:
  autoconfigure:
    exclude:
      - org.springframework.boot.autoconfigure.security.servlet.SecurityAutoConfiguration
```

#### æ–¹æ¡ˆä¸‰ï¼šé…ç½®åŸºæœ¬èªè­‰ï¼ˆç”Ÿç”¢ç’°å¢ƒï¼‰

å¦‚æœéœ€è¦åŸºæœ¬èªè­‰ï¼Œåœ¨ `application.yml` ä¸­é…ç½®ï¼š

```yaml
spring:
  security:
    user:
      name: admin
      password: your-secure-password
      roles: ADMIN
```

### å•é¡Œ 2ï¼šé …ç›®å•Ÿå‹•å¤±æ•—

**å¸¸è¦‹éŒ¯èª¤åŠè§£æ±ºæ–¹æ¡ˆ**ï¼š

#### éŒ¯èª¤ï¼šNeo4j é€£æ¥å¤±æ•—

```
Failed to obtain connection from pool within configured maximum time
```

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
```bash
# 1. æª¢æŸ¥ Neo4j æ˜¯å¦é‹è¡Œ
docker-compose ps neo4j

# 2. å•Ÿå‹• Neo4j
docker-compose up -d neo4j

# 3. ç­‰å¾… Neo4j å®Œå…¨å•Ÿå‹•ï¼ˆç´„ 30 ç§’ï¼‰
docker-compose logs -f neo4j

# 4. æ¸¬è©¦é€£æ¥
docker-compose exec neo4j cypher-shell -u neo4j -p password123
```

#### éŒ¯èª¤ï¼šç«¯å£ 8080 è¢«å ç”¨

```
Port 8080 was already in use
```

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
```bash
# æ–¹æ³•ä¸€ï¼šæ›´æ”¹ç«¯å£
export SERVER_PORT=8081
mvn spring-boot:run -pl graph-rag-api -Dserver.port=8081

# æ–¹æ³•äºŒï¼šæ‰¾åˆ°ä¸¦åœæ­¢å ç”¨é€²ç¨‹
lsof -i :8080
kill -9 <PID>
```

#### éŒ¯èª¤ï¼šOpenAI API èª¿ç”¨å¤±æ•—

```
OpenAI API call failed: Unauthorized
```

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
```bash
# è¨­ç½®æ­£ç¢ºçš„ API Key
export OPENAI_API_KEY="your-real-openai-api-key"

# æ¸¬è©¦ API Key æ˜¯å¦æœ‰æ•ˆ
curl -H "Authorization: Bearer $OPENAI_API_KEY" \
  https://api.openai.com/v1/models
```

### å•é¡Œ 3ï¼šç·¨è­¯éŒ¯èª¤

#### éŒ¯èª¤ï¼šJava ç‰ˆæœ¬ä¸å…¼å®¹

```
Source option 17 is no longer supported. Use 18 or later.
```

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
```bash
# æª¢æŸ¥ Java ç‰ˆæœ¬
java -version

# ç¢ºä¿ä½¿ç”¨ Java 17 æˆ–æ›´é«˜ç‰ˆæœ¬
export JAVA_HOME=/path/to/java17
```

#### éŒ¯èª¤ï¼šä¾è³´ä¸‹è¼‰å¤±æ•—

```
Could not resolve dependencies
```

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
```bash
# æ¸…ç†ä¸¦é‡æ–°ä¸‹è¼‰ä¾è³´
mvn clean
mvn dependency:resolve
mvn compile
```

## ğŸ”§ å®Œæ•´å•Ÿå‹•æµç¨‹

### æ–¹æ³•ä¸€ï¼šå¿«é€Ÿå•Ÿå‹•ï¼ˆæ¨è–¦ï¼‰

```bash
# 1. è¨­ç½®ç’°å¢ƒè®Šé‡
export OPENAI_API_KEY="your-openai-api-key"
export NEO4J_PASSWORD="password123"

# 2. å•Ÿå‹•åŸºç¤è¨­æ–½
docker-compose up -d neo4j redis

# 3. ç­‰å¾…æœå‹™å•Ÿå‹•
sleep 30

# 4. ç·¨è­¯ä¸¦å•Ÿå‹•æ‡‰ç”¨
mvn clean compile -DskipTests
mvn spring-boot:run -pl graph-rag-api
```

### æ–¹æ³•äºŒï¼šä½¿ç”¨å•Ÿå‹•è…³æœ¬

```bash
# ä½¿ç”¨æä¾›çš„å•Ÿå‹•è…³æœ¬
./start.sh
```

### æ–¹æ³•ä¸‰ï¼šIDE ä¸­å•Ÿå‹•

1. **IntelliJ IDEA**ï¼š
   - è¨­ç½®ç’°å¢ƒè®Šé‡ï¼šRun Configuration â†’ Environment Variables
   - æ·»åŠ ï¼š`OPENAI_API_KEY=your-key`ã€`NEO4J_PASSWORD=password123`
   - é‹è¡Œ `GraphRagApiApplication.main()`

2. **VS Code**ï¼š
   - å‰µå»º `.vscode/launch.json`ï¼š
   ```json
   {
     "version": "0.2.0",
     "configurations": [
       {
         "type": "java",
         "name": "Graph RAG API",
         "request": "launch",
         "mainClass": "com.graphrag.api.GraphRagApiApplication",
         "env": {
           "OPENAI_API_KEY": "your-key",
           "NEO4J_PASSWORD": "password123"
         }
       }
     ]
   }
   ```

## ğŸ§ª å•Ÿå‹•å¾Œé©—è­‰

### 1. å¥åº·æª¢æŸ¥

```bash
curl http://localhost:8080/api/v1/graph-rag/health
```

**é æœŸéŸ¿æ‡‰**ï¼š
```json
{
  "success": true,
  "data": {
    "status": "healthy",
    "components": {
      "database": {"status": "up"},
      "cache": {"status": "up"}
    }
  }
}
```

### 2. Swagger æ–‡æª”

è¨ªå•ï¼šhttp://localhost:8080/swagger-ui.html

### 3. æ¸¬è©¦ API

```bash
curl -X POST http://localhost:8080/api/v1/graph-rag/query \
  -H "Content-Type: application/json" \
  -d '{
    "question": "ä»€éº¼æ˜¯äººå·¥æ™ºèƒ½ï¼Ÿ",
    "retrievalMode": "hybrid",
    "maxDocuments": 5
  }'
```

## ğŸ› èª¿è©¦æŠ€å·§

### 1. æŸ¥çœ‹è©³ç´°æ—¥èªŒ

```bash
# Maven å•Ÿå‹•æ™‚é¡¯ç¤ºè©³ç´°æ—¥èªŒ
mvn spring-boot:run -pl graph-rag-api -X

# æˆ–è€…è¨­ç½®æ—¥èªŒç´šåˆ¥
mvn spring-boot:run -pl graph-rag-api \
  -Dspring-boot.run.jvmArguments="-Dlogging.level.com.graphrag=DEBUG"
```

### 2. æª¢æŸ¥é…ç½®

```bash
# æŸ¥çœ‹ç•¶å‰é…ç½®
curl http://localhost:8080/actuator/configprops

# æŸ¥çœ‹ç’°å¢ƒè®Šé‡
curl http://localhost:8080/actuator/env
```

### 3. ç›£æ§æ‡‰ç”¨ç‹€æ…‹

```bash
# æ‡‰ç”¨æŒ‡æ¨™
curl http://localhost:8080/actuator/metrics

# JVM ä¿¡æ¯
curl http://localhost:8080/actuator/metrics/jvm.memory.used
```

## ğŸ”’ Security é…ç½®è©³è§£

### ç•¶å‰é…ç½®èªªæ˜

`SecurityConfig.java` é…ç½®äº†ä»¥ä¸‹å®‰å…¨ç­–ç•¥ï¼š

1. **ç¦ç”¨ CSRF**ï¼šAPI æœå‹™ä¸éœ€è¦ CSRF ä¿è­·
2. **ç„¡ç‹€æ…‹æœƒè©±**ï¼šä½¿ç”¨ JWT æˆ–ç„¡ç‹€æ…‹èªè­‰
3. **å…è¨±çš„ç«¯é»**ï¼š
   - `/api/v1/graph-rag/health` - å¥åº·æª¢æŸ¥
   - `/swagger-ui/**` - API æ–‡æª”
   - `/actuator/**` - ç›£æ§ç«¯é»
   - `/api/**` - æ‰€æœ‰ API è«‹æ±‚

### å¦‚æœéœ€è¦å•Ÿç”¨èªè­‰

å¦‚æœç”Ÿç”¢ç’°å¢ƒéœ€è¦èªè­‰ï¼Œå¯ä»¥ä¿®æ”¹ `SecurityConfig.java`ï¼š

```java
.authorizeHttpRequests(authz -> authz
    .requestMatchers("/api/v1/graph-rag/health").permitAll()
    .requestMatchers("/swagger-ui/**").permitAll()
    .anyRequest().authenticated()
)
.httpBasic(Customizer.withDefaults()) // å•Ÿç”¨åŸºæœ¬èªè­‰
```

## ğŸ“ ç²å–å¹«åŠ©

### å¸¸ç”¨æ’æŸ¥å‘½ä»¤

```bash
# æª¢æŸ¥æœå‹™ç‹€æ…‹
curl -f http://localhost:8080/api/v1/graph-rag/health || echo "Service not ready"

# æª¢æŸ¥ç«¯å£å ç”¨
lsof -i :8080

# æª¢æŸ¥ Java é€²ç¨‹
jps -l | grep GraphRag

# æŸ¥çœ‹æ‡‰ç”¨æ—¥èªŒ
tail -f logs/application.log
```

### æ”¶é›†è¨ºæ–·ä¿¡æ¯

å¦‚æœå•é¡Œä»ç„¶å­˜åœ¨ï¼Œè«‹æ”¶é›†ä»¥ä¸‹ä¿¡æ¯ï¼š

1. **ç³»çµ±ä¿¡æ¯**ï¼š
   ```bash
   uname -a
   java -version
   mvn -version
   docker --version
   ```

2. **ç’°å¢ƒè®Šé‡**ï¼š
   ```bash
   env | grep -E "(JAVA|MAVEN|OPENAI|NEO4J)"
   ```

3. **éŒ¯èª¤æ—¥èªŒ**ï¼š
   - å®Œæ•´çš„å•Ÿå‹•æ—¥èªŒ
   - éŒ¯èª¤å †æ£§è·Ÿè¸ª
   - ç›¸é—œé…ç½®æ–‡ä»¶å…§å®¹

4. **ç¶²çµ¡é€£æ¥**ï¼š
   ```bash
   curl -v http://localhost:8080/api/v1/graph-rag/health
   ```

### è¯ç¹«æ”¯æŒ

- æŠ€è¡“æ”¯æŒï¼šsupport@graphrag.com
- GitHub Issuesï¼šhttps://github.com/your-org/graph-rag-solution/issues
- æ–‡æª”ï¼šæŸ¥çœ‹ `docs/` ç›®éŒ„ä¸‹çš„è©³ç´°æ–‡æª”

---

**æç¤º**ï¼šå¤§å¤šæ•¸å•Ÿå‹•å•é¡Œéƒ½æ˜¯ç”±æ–¼ç’°å¢ƒé…ç½®æˆ–ä¾è³´æœå‹™æœªå•Ÿå‹•å°è‡´çš„ã€‚è«‹æŒ‰ç…§ä¸Šè¿°æ­¥é©Ÿé€ä¸€æ’æŸ¥ï¼Œé€šå¸¸å¯ä»¥å¿«é€Ÿè§£æ±ºå•é¡Œã€‚ 